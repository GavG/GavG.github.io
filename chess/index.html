<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>Chess</title>
  <style>
    html,
    body {
      margin: 0px;
      padding: 0px;
    }

    body {
      background: #353535;
      font: normal 9vh "Lucida Sans Unicode", "Lucida Grande", "Arial Unicode MS", sans-serif;
    }

    table {
      margin: 1vh auto;
      background: #DB8;
      border-collapse: collapse;
    }

    td {
      width: 12vh;
      height: 12vh;
      text-align: center;
      font-size: 9vh;
      padding: 0px;
    }

    tr:nth-child(even) td:nth-child(odd) {
      background: #555;
    }

    tr:nth-child(odd) td:nth-child(even) {
      background: #555;
    }

    td.b {
      color: #000;
    }

    td.w {
      color: #f9f9f9;
    }

    td.h:after {
      content: '';
      background-color: #33889955;
      width: 12vh;
      height: 12vh;
      display: table-cell;
    }

    td.R:after {
      content: '\265C';
    }

    td.N:after {
      content: '\265E';
    }

    td.B:after {
      content: '\265D';
    }

    td.K:after {
      content: '\265A';
    }

    td.Q:after {
      content: '\265B';
    }

    td.P:after {
      content: '\265F';
    }

    td:after {
      top: 0;
      background-color: transparent;
      position: relative;
      transition: all 0.2s ease-in-out;
    }

    td.a {
      background-color: #ff9900 !important;
    }

    td.y-1:after {
      top: -12vh;
    }

    td.y-2:after {
      top: -24vh;
    }

    td.y-3:after {
      top: -36vh;
    }

    td.y-4:after {
      top: -48vh;
    }

    td.y-5:after {
      top: -60vh;
    }

    td.y-6:after {
      top: -72vh;
    }

    td.y-7:after {
      top: -84vh;
    }

    td.y1:after {
      top: 12vh;
    }

    td.y2:after {
      top: 24vh;
    }

    td.y3:after {
      top: 36vh;
    }

    td.y4:after {
      top: 48vh;
    }

    td.y5:after {
      top: 60vh;
    }

    td.y6:after {
      top: 72vh;
    }

    td.y7:after {
      top: 84vh;
    }
  </style>
</head>

<body>
  <table id='board'>
    <tr>
      <td class='b R'></td>
      <td class='b N'></td>
      <td class='b B'></td>
      <td class='b Q'></td>
      <td class='b K'></td>
      <td class='b B'></td>
      <td class='b N'></td>
      <td class='b R'></td>
    </tr>
    <tr>
      <td class='b P'></td>
      <td class='b P'></td>
      <td class='b P'></td>
      <td class='b P'></td>
      <td class='b P'></td>
      <td class='b P'></td>
      <td class='b P'></td>
      <td class='b P'></td>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td class='w P'></td>
      <td class='w P'></td>
      <td class='w P'></td>
      <td class='w P'></td>
      <td class='w P'></td>
      <td class='w P'></td>
      <td class='w P'></td>
      <td class='w P'></td>
    </tr>
    <tr>
      <td class='w R'></td>
      <td class='w N'></td>
      <td class='w B'></td>
      <td class='w Q'></td>
      <td class='w K'></td>
      <td class='w B'></td>
      <td class='w N'></td>
      <td class='w R'></td>
    </tr>
  </table>
</body>

<script type="text/javascript">
  const white = 'w';
  const black = 'b';
  const active_class = 'a';
  const highlighted_class = 'h';

  var board = document.getElementById('board');
  var cells = board.getElementsByTagName('td');
  var active_cell = null;
  var turn = white;
  var highlighted_cells = [];

  board.addEventListener('click', function(event) {
    cell = event.target;

    if (active_cell && isHighlightedCell(cell)) {
      var target_cell = active_cell;
      clearActiveCell();
      clearHighlightedCells();
      movePiece(target_cell, cell)
      return turn = (turn == white) ? black : white;
    }

    if (isPlayablePiece(cell)) {
      setActiveCell(cell);
    } else {
      clearActiveCell();
      clearHighlightedCells();
    }
  })

  function isPlayablePiece(cell) {
    return cell.classList.contains(turn);
  }

  function clearActiveCell() {
    if (active_cell) {
      active_cell.classList.remove(active_class);
      active_cell = null;
    }
  }

  function setActiveCell(cell) {
    clearActiveCell();
    if (active_cell != cell) {
      active_cell = cell;
      cell.classList.add(active_class);
      highlightCells(viableCells(cell));
    } else {
      active_cell = null;
    }
  }

  function highlightCells(cells = []) {
    clearHighlightedCells();
    highlighted_cells = cells;
    for (var i = 0; i < cells.length; i++) {
      cells[i].classList.add(highlighted_class);
    }
  }

  function clearHighlightedCells() {
    dehighlightCells(highlighted_cells);
  }

  function dehighlightCells(cells = []) {
    for (var i = 0; i < cells.length; i++) {
      cells[i].classList.remove(highlighted_class);
    }
  }


  function isHighlightedCell(cell) {
    if (cell) return cell.classList.contains(highlighted_class);
  }

  function movePiece(current_cell, new_cell) {
    var base_class_list = [].slice.call(current_cell.classList);
    var x = new_cell.cellIndex - current_cell.cellIndex
    var y = new_cell.parentNode.rowIndex - current_cell.parentNode.rowIndex;

    if (x) current_cell.classList.add('x' + x);
    if (y) current_cell.classList.add('y' + y);

    setTimeout(function() {
      new_cell.classList.add(...base_class_list);
      current_cell.classList = [];
    }, 200)
  }

  function is_white(cell) {
    return cell.classList.contains(white);
  }

  function is_black(cell) {
    return cell.classList.contains(black);
  }

  function is_occupied(cell) {
    return is_black(cell) || is_white(cell);
  }

  function is_capturable(cell) {
    switch (turn) {
      case black:
        return is_white(cell);
      case white:
        return is_black(cell);
    }
  }

  function viableCells(cell) {

    var cell_is_white = is_white(cell);
    var cell_is_black = is_black(cell);

    if (cell.classList.contains('P')) {
      if ((cell_is_black && cell.parentNode.rowIndex == 1) || (cell_is_white && cell.parentNode.rowIndex == 6)) {
        return n_y(1, cell, 2, true, false);
      } else {
        return n_y(1, cell, 1, false, false);
      }
    }

    if (cell.classList.contains('R')) {
      //forwards, back, left, right
      return n_y(-1, cell, 7, true, true).concat(n_y(1, cell, 7, true, true));
    }
  }

  function n_y(heading = 1, cell, n, inclusive, can_capture) {
    var y = cell.parentNode.rowIndex;
    var viable_cells = [];
    var direction = (is_black(cell) ? 1 : -1) * heading;

    if (inclusive) {
      for (var i = 1; i < n + 1; i++) {
        var row = board.rows[(direction * i) + y];
        if (row) {
          var cell = row.cells[cell.cellIndex];
          if (!is_occupied(cell) || (can_capture && is_capturable(cell))) {
            viable_cells.push(cell);
          } else {
            return viable_cells;
          }
        }
      }
    } else {
      var row = board.rows[(direction * n) + y];
      if (row) {
        var cell = row.cells[cell.cellIndex];
        if (can_capture || !is_occupied(cell)) {
          viable_cells.push(cell);
        }
      }
    }

    return viable_cells;
  }

  function n_diagonal_forwards(cell, n, inclusive, can_capture, can_only_capture = false) {
    var y = cell.parentNode.rowIndex;
    var viable_cells = [];
    var direction = is_black(cell) ? 1 : -1;


  }
</script>

</html>